

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>&lt;no title&gt; &#8212; Stata Programming</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lecture4do';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="https://brand.jhu.edu/assets/uploads/sites/5/2014/06/university_logo_small_vertical_blue.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="https://brand.jhu.edu/assets/uploads/sites/5/2014/06/university_logo_small_vertical_blue.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Preface
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="chapter1.html">1. Philosophy, overview, commands, syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter2.html">2. Return values, macros, programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter3.html">3. Loops, Program Syntax, and Miscellany</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter4.html">4. Advanced file management</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter5.html">5. Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter6.html">6. Review of Weeks 1-5</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter7.html">7. Survival Analysis: Non-parametric, Semi-parametric, Parametric</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter8.html">8. Multilevel, Hierarchical Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickrefs.html">Quick References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Flecture4do.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/lecture4do.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1><no title></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="simple visible nav section-nav flex-column">
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <p>Code block followed with documentation!</p>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="k">capture log close</span>
<span class="k">log</span> using lecture4<span class="m">.</span>log,<span class="k"> replace</span> text

<span class="c1">//This log file contains most of the examples used in Lecture 4 of</span>
<span class="c1">//summer Stata Programming and Data Management, </span>
<span class="cs">///along with additional explanations and examples.</span>

<span class="k">version</span> <span class="m">12</span> <span class="c1">//We&#39;re teaching new-style merging</span>
<span class="k">clear</span> all <span class="c1">//clear all data from memory</span>
<span class="k">macro drop</span> _all <span class="c1">//clear all macros in memory</span>
<span class="k">set more</span> off   <span class="c1">//give output all at once (not one screenful at a time)</span>
<span class="k">set</span> linesize <span class="m">80</span> <span class="c1">//maximum allowed width for output</span>
</pre></div>
</div>
<p>In the code above, the capture log close command is used to close any previously open log files. The log using lecture4.log, replace text command opens a new log file named “lecture4.log” and replaces its contents if it already exists. The text option specifies that both the executed code and the output should be logged.</p>
<p>The subsequent comments provide a brief description of the log file’s purpose, stating that it contains examples used in Lecture 4 of a Stata Programming and Data Management course, along with additional explanations and examples.</p>
<p>The version 12 command sets the Stata version to 12, indicating that the code is compatible with that version. The clear all command clears all data from memory, removing any previously loaded datasets. The macro drop _all command clears all macros in memory. The set more off command disables the feature that displays output one screenful at a time, showing all output at once. Finally, the set linesize 80 command sets the maximum allowed width for output to 80 characters, ensuring that output is displayed within the specified limit.</p>
<p>These initial steps help prepare the environment for executing the subsequent code and logging the results in the “lecture4.log” file.</p>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> transplants,<span class="k"> clear</span>

<span class="c1">//examples of syntax for merging</span>
<span class="c1">//NOTE: after each example we reload transplants.dta</span>

<span class="c1">//simplest merge: link data in memory (transplants.dta) to donors_recipients.dta</span>
<span class="c1">//by matching on the variable fake_id which appears in both datasets</span>
<span class="k">merge</span> <span class="m">1</span>:<span class="m">1</span> fake_id using donors_recipients

<span class="c1">//the merge command creates a new variable, _merge</span>
<span class="c1">//check how many records matched</span>
<span class="k">tab</span> _merge

<span class="c1">//&quot;master&quot; = dataset that was in memory before we merged</span>
<span class="c1">//&quot;using&quot; = dataset that we are bringing in with the merge command</span>
<span class="c1">//&quot;match&quot; = appears in both master and using datasets</span>
</pre></div>
</div>
<p>In the code above, we start by using the dataset transplants and clearing any existing data in memory. Then, we demonstrate examples of syntax for merging datasets.</p>
<p>The first example shows the simplest merge where we link the data in memory (transplants.dta) to donors_recipients.dta using a one-to-one match on the variable fake_id which appears in both datasets. The merge command is used for merging.</p>
<p>After the merge, a new variable called _merge is created. To check how many records matched during the merge, we use the tab command on _merge.</p>
<p>In the context of merging, the terms “master” and “using” refer to the datasets involved in the merge operation. “Master” refers to the dataset that was in memory before the merge, while “using” refers to the dataset that we are bringing in with the merge command. The term “match” indicates the records that appear in both the master and using datasets.</p>
<p>Please let me know if you need further assistance or if there’s anything else I can help you with!</p>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> transplants,<span class="k"> clear</span>
<span class="k">merge</span> <span class="m">1</span>:<span class="m">1</span> fake_id using donors_recipients,<span class="k"> keep</span>(match)
<span class="c1">//only keep records that appear both in the original dataset and in the new dataset</span>

<span class="k">use</span> transplants,<span class="k"> clear</span>
<span class="k">merge</span> <span class="m">1</span>:<span class="m">1</span> fake_id using donors_recipients,<span class="k"> keep</span>(master match)
<span class="c1">//only keep records that appear in the master dataset only, or both datasets</span>

<span class="k">use</span> transplants,<span class="k"> clear</span>
<span class="k">merge</span> <span class="m">1</span>:<span class="m">1</span> fake_id using donors_recipients,<span class="k"> keep</span>(master using)
<span class="c1">//only keep records that appear in the master dataset only, or the using dataset only, but not both</span>

<span class="k">use</span> transplants,<span class="k"> clear</span>
<span class="k">merge</span> <span class="m">1</span>:<span class="m">1</span> fake_id using donors_recipients,<span class="k"> keep</span>(master match)<span class="k"> gen</span>(mergevar)
<span class="c1">//call the newly created variable &quot;mergevar&quot; instead of &quot;_merge&quot;</span>

<span class="k">use</span> transplants,<span class="k"> clear</span>
<span class="k">merge</span> <span class="m">1</span>:<span class="m">1</span> fake_id using donors_recipients,<span class="k"> keep</span>(match) nogen
<span class="c1">//don&#39;t create a new variable</span>

<span class="k">merge m</span>:<span class="m">1</span> fake_don_id using donors,<span class="k"> keep</span>(match) nogen keepusing(age_don)
<span class="c1">//don&#39;t load all the new variables from the donors dataset, just load age_don.</span>

<span class="k">corr</span> age<span class="o">*</span>
<span class="c1">//are donor age and recipient age correlated in our fake data? No.</span>

<span class="c1">//merging: using assert to make sure that all your records match</span>
<span class="k">use</span> transplants,<span class="k"> clear</span>
<span class="k">merge</span> <span class="m">1</span>:<span class="m">1</span> fake_id using donors_recipients,<span class="k"> keep</span>(master match)
<span class="k">assert</span> _merge<span class="o">==</span><span class="m">3</span>
<span class="k">drop</span> _merge

<span class="c1">//merging: using assert to make sure that *most* of your records match</span>
<span class="k">use</span> transplants,<span class="k"> clear</span>
<span class="k">merge</span> <span class="m">1</span>:<span class="m">1</span> fake_id using donors_recipients,<span class="k"> keep</span>(master match)
<span class="k">assert</span> <span class="nf">inlist</span>(_merge, <span class="m">1</span>, <span class="m">3</span>) <span class="c1">//master only or matched</span>
<span class="k">quietly count if</span> _merge <span class="o">==</span> <span class="m">3</span>
<span class="k">assert</span> <span class="nf">r</span>(N)<span class="o">/</span>_N <span class="o">&gt;</span> <span class="m">0.99</span>  <span class="c1">//99% of records have _merge==3</span>
<span class="k">drop</span> _merge
</pre></div>
</div>
<p>In the code above, we continue with examples of merging datasets using different options:</p>
<p>The first example merges the datasets transplants.dta and donors_recipients.dta based on a one-to-one match on the variable fake_id. It keeps only the records that appear in both datasets using the keep(match) option.</p>
<p>The second example keeps records that appear in the master dataset only or in both datasets using the keep(master match) option.
The third example keeps records that appear in the master dataset only or the using dataset only, but not in both, using the keep(master using) option.</p>
<p>The fourth example creates a new variable called “mergevar” instead of the default _merge using the gen(mergevar) option.<br />
The fifth example performs the merge but does not create a new variable using the nogen option.<br />
The sixth example demonstrates merging using a one-to-many match (m:1) and selects specific variables to load from the donors dataset using the keepusing() option.<br />
The code then computes the correlation between the variables age_don and age_rec using the corr command to check if donor age and recipient age are correlated in the fake data.<br />
The next set of examples introduces the use of assert to check the validity of the merge. The first example uses assert to ensure that all records have a _merge value of 3 (indicating a match) and then drops the _merge variable.<br />
The second example uses assert to check that most of the records have a _merge value of 1 (indicating they are in the master dataset) or 3 (indicating a match), with at least 99% of the records meeting this condition. The _merge variable is dropped afterwards.</p>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">//by</span>

<span class="k">use</span> transplants,<span class="k"> clear</span>
<span class="k">sort</span> abo
<span class="k">by</span> abo:<span class="k"> gen</span> cat_n = _N <span class="c1">//cat_n = # records in each abo category</span>

<span class="k">sort</span> abo age
<span class="k">by</span> abo:<span class="k"> gen</span> cat_id = _n <span class="c1">//1 for youngest patient, 2 for next youngest, etc.</span>


<span class="c1">//egen</span>

<span class="c1">//obtaining mean age and storing it in a variable</span>
<span class="k">use</span> transplants,<span class="k"> clear</span>
<span class="k">egen</span> mean_age =<span class="k"> mean</span>(age)

<span class="c1">//more egen examples</span>
<span class="k">egen</span> median_age =<span class="k"> median</span>(age)
<span class="k">egen</span> max_age = <span class="nf">max</span>(age)
<span class="k">egen</span> min_age = <span class="nf">min</span>(age)
<span class="k">egen</span> age_q1 =<span class="k"> pctile</span>(age), p(<span class="m">25</span>) <span class="c1">//25th percentile</span>
<span class="k">egen</span> age_sd = sd(age)  <span class="c1">//standard deviation</span>
<span class="k">egen</span> total_prev =<span class="k"> sum</span>(prev) <span class="c1">//add all the values (all are 1 or 0 in this case)</span>

<span class="c1">//using egen with by</span>
<span class="k">use</span> transplants,<span class="k"> clear</span>
<span class="k">sort</span> dx
<span class="k">by</span> dx:<span class="k"> egen</span> mean_age =<span class="k"> mean</span>(age)
<span class="k">by</span> dx:<span class="k"> egen</span> min_bmi = <span class="nf">min</span>(bmi)

<span class="c1">//combining sort and by to get bysort / bys</span>
<span class="k">use</span> transplants,<span class="k"> clear</span>
<span class="k">bys</span> abo:<span class="k"> egen</span> m_bmi=mean(bmi)
<span class="k">bys</span> abo gender:<span class="k"> egen</span> max_bmi = <span class="nf">max</span>(bmi)
<span class="k">bys</span> abo gender:<span class="k"> egen</span> min_bmi = <span class="nf">min</span>(bmi)
<span class="k">gen</span> spread = max_bmi <span class="o">-</span> min_bmi

<span class="c1">//egen = tag</span>
<span class="k">egen</span> grouptag = tag(abo gender)
<span class="c1">//now, for all groups of abo/gender, (1/M, 3/F, etc), there&#39;s exactly one</span>
<span class="c1">//record that has grouptag = &quot;1&quot;. All others have grouptag = &quot;0&quot;.</span>

<span class="k">list</span> abo gend spread<span class="k"> if</span> grouptag

<span class="c1">//more examples of bys</span>
<span class="k">use</span> donors_recipients,<span class="k"> clear</span>
<span class="k">bys</span> fake_don:<span class="k"> gen</span> n_tx = _N
<span class="k">bys</span> fake_don:<span class="k"> gen</span> tx_id = _n
<span class="k">egen</span> don_tag = tag(fake_don)
<span class="k">tab</span> n_tx<span class="k"> if</span> don_tag


<span class="c1">//graphing example with egen and tag</span>
<span class="k">use</span> transplants,<span class="k"> clear</span>
<span class="k">egen</span> tag_race = tag(race)
<span class="k">bys</span> race:<span class="k"> egen</span> mean_bmi=mean(bmi)
<span class="k">bys</span> race:<span class="k"> egen</span> mean_age=mean(age)

<span class="k">label</span> define race_label <span class="m">1</span> <span class="s">&quot;White&quot;</span> <span class="cs">///</span>
    <span class="m">2</span> <span class="s">&quot;Black/AA&quot;</span> <span class="m">4</span> <span class="s">&quot;Hispanic/Latino&quot;</span> <span class="cs">///</span>
    <span class="m">5</span> <span class="s">&quot;East Asian&quot;</span> <span class="m">6</span> <span class="s">&quot;Native American&quot;</span> <span class="cs">///</span>
    <span class="m">7</span> <span class="s">&quot;Asian Indian&quot;</span> <span class="m">9</span> <span class="s">&quot;Other&quot;</span>  <span class="c1">//create a label race_label</span>

<span class="c1">//I personally find this more legible than cond() with seven cases,</span>
<span class="c1">//although cond() has its champions</span>
<span class="k">gen</span> racedesc = <span class="s">&quot;White/Caucasian&quot;</span><span class="k"> if</span> race<span class="o">==</span><span class="m">1</span>
<span class="k">replace</span> racedesc = <span class="s">&quot;Black/AA&quot;</span><span class="k"> if</span> race<span class="o">==</span><span class="m">2</span>
<span class="k">replace</span> racedesc = <span class="s">&quot;Hispanic/Latino&quot;</span><span class="k"> if</span> race<span class="o">==</span><span class="m">4</span>
<span class="k">replace</span> racedesc = <span class="s">&quot;Native American&quot;</span><span class="k"> if</span> race<span class="o">==</span><span class="m">5</span>
<span class="k">replace</span> racedesc = <span class="s">&quot;East Asian&quot;</span><span class="k"> if</span> race<span class="o">==</span><span class="m">6</span>
<span class="k">replace</span> racedesc = <span class="s">&quot;Asian Indian&quot;</span><span class="k"> if</span> race<span class="o">==</span><span class="m">7</span>
<span class="k">replace</span> racedesc = <span class="s">&quot;Other&quot;</span><span class="k"> if</span> race<span class="o">==</span><span class="m">9</span>

<span class="k">twoway scatter m</span><span class="o">~</span>_bmi<span class="k"> m</span><span class="o">~</span>_age<span class="k"> if</span> tag_race, <span class="cs">///</span>
    title(<span class="s">&quot;Mean age and BMI by race/ethnicity&quot;</span>) <span class="cs">///</span>
    xtitle(<span class="s">&quot;Mean age&quot;</span>) ytitle(<span class="s">&quot;Mean BMI&quot;</span>) <span class="cs">///</span>
    xlabel(<span class="m">40</span>(<span class="m">2</span>)<span class="m">60</span>) ylabel(<span class="m">20</span>(<span class="m">2</span>)<span class="m">30</span>) <span class="cs">///</span>
    mlabel(racedesc)
<span class="k">graph</span> export graph_lecture4<span class="m">.</span>png,<span class="k"> replace</span> width(<span class="m">2400</span>)
</pre></div>
</div>
<p>In the code above, we cover examples related to the by</p>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span>//math functions

//setup for math functions
clear
set obs 1000
gen n = _n/100 - 5

//rounding method 1: floor
disp floor(0.3)
disp floor(4.5)
disp floor(8.9)

//rounding method 2: ceil
disp ceil(0.3)
disp ceil(4.5)
disp ceil(8.9)

//rounding method 3: round
disp round(0.3)
disp round(4.5)
disp round(8.9)

//using round to round to something other than nearest integer
disp round(-0.32, 0.1)  //round to nearest 0.1
disp round(4.5, 2)   //round to nearest 2
disp round(8.9, 10)  //round to nearest 10

//min and max
disp min(8,6,7,5,3,0,9) //display minimum value
disp max(8,6,7,5,3,0,9) //display maximum value

//other math functions
disp exp(1)  //exponent. e^1 = e.
disp ln(20)  //log of 20 ~ 3
disp sqrt(729)  //27

disp abs(-6)  //absolute value
disp mod(529, 10) //modulus (remainder)
disp c(pi)  //constant pi (for illustration of sine)
disp sin(c(pi)/2) //sine function

//string functions
use transplants, clear
list extended_dgn in 1/5, clean

disp word(&quot;Hello, is there anybody in there?&quot;, 4)
list extended_dgn if word(ext, 5) != &quot;&quot;, clean noobs
disp strlen(&quot;Same as it ever was&quot;)
list extended_dgn if strlen(ext)&lt; 6, clean
assert regexm(&quot;Earth&quot;, &quot;art&quot;)
assert !regexm(&quot;team&quot;, &quot;I&quot;)

tab ext if regexm(ext, &quot;HTN&quot;)
list ext if regexm(ext, &quot;^A&quot;) 
//starts with A

list ext if regexm(ext, &quot;X$&quot;) 
//ends with X

tab ext if regexm(ext, &quot;HIV.*Y&quot;) 
//contains &quot;HIV&quot;, then some other stuff, then Y
</pre></div>
</div>
<p>That’s it with the math functions</p>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">//date and time functions</span>
<span class="c1">//review of number formats</span>
<span class="k">disp</span> <span class="nx">%3.2f</span> <span class="nf">exp</span>(<span class="m">1</span>)
<span class="k">disp</span> <span class="nx">%4.1f</span> <span class="m">3.14159</span>

<span class="c1">//examples of the %td format for dates (days since 1/1/1960)</span>
<span class="k">disp</span> <span class="nx">%td</span> <span class="m">19400</span>
<span class="k">disp</span> <span class="nx">%td</span> <span class="m">366</span>
<span class="k">disp</span> <span class="nx">%td</span> <span class="o">-</span><span class="m">5</span>

<span class="c1">//doing math on Stata dates</span>
<span class="k">use</span> transplants,<span class="k"> clear</span>
<span class="k">gen</span> oneweek = transplant_date <span class="o">+</span><span class="m">7</span>
<span class="k">format</span> <span class="nx">%td</span> oneweek
<span class="k">list</span> transplant_date  oneweek<span class="k"> in</span> <span class="m">1</span><span class="o">/</span><span class="m">3</span>

<span class="c1">//date functions</span>
<span class="c1">//td() function to give the integer date for a given calendar date</span>
<span class="k">disp</span> <span class="nf">td</span>(04jul1976)

<span class="c1">//&quot;Back to the future&quot; start date</span>
<span class="k">disp</span> <span class="nf">td</span>(26oct1985) 

<span class="c1">//mdy() function to give the integer date for a given month/day/year</span>
<span class="k">disp</span> <span class="nf">mdy</span>(<span class="m">7</span>,<span class="m">4</span>,<span class="m">1976</span>)

<span class="c1">//&quot;Back to the future&quot; start date</span>
<span class="k">disp</span> <span class="nf">mdy</span>(<span class="m">10</span>,<span class="m">26</span>,<span class="m">1985</span>) 



<span class="c1">//date() function to convert strings to dates</span>
<span class="c1">//Woodstock festival starts</span>
<span class="k">disp</span> <span class="nf">date</span>(<span class="s">&quot;August 15, 1969&quot;</span>, <span class="s">&quot;MDY&quot;</span>)
<span class="c1">//Next perihelion of Halley&#39;s comet</span>
<span class="k">disp</span> <span class="nf">date</span>(<span class="s">&quot;2061 28 July&quot;</span>, <span class="s">&quot;YDM&quot;</span>)

<span class="k">use</span> donors,<span class="k"> clear</span>
<span class="k">gen</span> donor_dob = <span class="nf">date</span>(fake_don_dob, <span class="s">&quot;DMY&quot;</span>)

<span class="k">format</span> <span class="nx">%td</span> donor_dob
<span class="k">list</span> donor_dob fake_don_dob<span class="k"> in</span> <span class="m">1</span><span class="o">/</span><span class="m">5</span>

<span class="k">use</span> transplants,<span class="k"> clear</span>
<span class="c1">//survival analysis overview</span>

<span class="c1">//prep work</span>
<span class="k">gen</span> f_time = end_date<span class="o">-</span>transplant_date

<span class="c1">//stset (1)</span>
<span class="k">stset</span> f_time, failure(died)

<span class="c1">//stset (2)</span>
<span class="k">stset</span> end_date, origin(transplant_date) failure(died)

<span class="c1">//set a scale to measure time in years instead of days</span>
<span class="k">stset</span> end_date, origin(transplant_date) failure(died) scale(<span class="m">365.25</span>)

<span class="c1">//Kaplan-Meier curve</span>
<span class="k">sts graph</span>

<span class="c1">//stratified K-M curve</span>
<span class="k">sts graph</span>,<span class="k"> by</span>(don_ecd)

<span class="c1">//calculate incidence rate per person-year</span>
<span class="k">stsum</span>
<span class="k">stsum</span>,<span class="k"> by</span>(don_ecd)

<span class="c1">//rank-sum tests</span>
<span class="k">sts test</span> don_ecd
<span class="k">sts test</span> gender
<span class="k">log close</span>
</pre></div>
</div>
<p>In the code above, we cover examples related to various math functions, string functions, date and time functions, and survival analysis functions in Stata. Each section is clearly commented to explain the purpose and usage of the specific functions.</p>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="simple visible nav section-nav flex-column">
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Abimereki Muzaale
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>