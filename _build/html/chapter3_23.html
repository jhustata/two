

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>by &#8212; Stata Programming</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapter3_23';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="https://brand.jhu.edu/assets/uploads/sites/5/2014/06/university_logo_small_vertical_blue.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="https://brand.jhu.edu/assets/uploads/sites/5/2014/06/university_logo_small_vertical_blue.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Preface
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="chapter1.html">1. Philosophy, overview, commands, syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter2.html">2. Return values, macros, programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter3.html">3. Loops, Program Syntax, and Miscellany</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter4.html">4. Advanced file management</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter5.html">5. Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter6.html">6. Review of Weeks 1-5</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter7.html">7. Survival Analysis: Non-parametric, Semi-parametric, Parametric</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter8.html">8. Multilevel, Hierarchical Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickrefs.html">Quick References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fchapter3_23.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/chapter3_23.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>by</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="by">
<h1>by<a class="headerlink" href="#by" title="Permalink to this heading">#</a></h1>
<p><a class="reference external" href="https://jhjhm.zoom.us/rec/share/8x0apHVqmnUHnuBfzLXMuvRRXkExSGeoQAw5rEs9OvKSmzs1bvhPfLD2pGu6NRY.BYToPUwpMdnR-h25?startTime=1681414214000">video</a> 04/13/2023 Includes introduction to <code class="docutils literal notranslate"><span class="pre">program</span> <span class="pre">define</span></code></p>
<p><a class="reference external" href="https://jhjhm.zoom.us/rec/share/NBtdk4SUC-ra9q7_tuGZEjuwS6o8cjB8U2dBnc_hSV7jM8joxdhlQ2ebQc8cILE2.GlIilOilIbw2w9tQ?startTime=1682019152000">video</a> 04/20/2023 Includes exercise in debugging &amp; discussion of HW1</p>
<p>The figure below outlines a schema of what we covered last week and attempts to generalize it to several scenarios beyond what we might have time to cover in 5 weeks. For instance, you may replace <code class="docutils literal notranslate"><span class="pre">sum</span></code> with <code class="docutils literal notranslate"><span class="pre">count</span></code>, <code class="docutils literal notranslate"><span class="pre">regression</span></code> with <code class="docutils literal notranslate"><span class="pre">kappa</span> <span class="pre">statistic</span> <span class="pre">estimation</span></code> (as one of your classmates did), or yet still <code class="docutils literal notranslate"><span class="pre">lincom</span></code> with a <code class="docutils literal notranslate"><span class="pre">matrix</span> <span class="pre">define</span> <span class="pre">m=r(table)</span></code> step.</p>
<p>For the latter case, each matrix value will contain <code class="docutils literal notranslate"><span class="pre">r()</span></code> class macros, which you may capture and format in a local macro like so:</p>
<p><code class="docutils literal notranslate"><span class="pre">local</span> <span class="pre">b_age:</span> <span class="pre">di</span> <span class="pre">%3.1f</span> <span class="pre">m[1,4]</span></code></p>
<p>Where <code class="docutils literal notranslate"><span class="pre">m</span></code> is the matrix you defined and <code class="docutils literal notranslate"><span class="pre">m[1,4]</span></code> is the value in row1, column4. And here is a script that outputs <code class="docutils literal notranslate"><span class="pre">r(table)</span></code> following a Cox regression into an excel file:</p>
<p><a class="reference external" href="https://raw.githubusercontent.com/jhustata/book/main/rtable.do">rtable.do</a></p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="c1">#import numpy as np</span>
<span class="c1">#import sklearn as skl</span>
<span class="c1"># </span>

<span class="c1">#plt.figure(figsize=[2, 2])</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
<span class="c1">#G.add_node(&quot; &quot;,  pos = (0, 3) )</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;regress&quot;</span><span class="p">,</span>  <span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">9.2</span><span class="p">)</span> <span class="p">)</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">)</span> <span class="p">)</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;lincom&quot;</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">)</span> <span class="p">)</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;r()&quot;</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">)</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;r()*&quot;</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">)</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;local&quot;</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.5</span><span class="p">))</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;embed&quot;</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="p">))</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">([</span>      <span class="p">(</span><span class="s2">&quot;regress&quot;</span><span class="p">,</span> <span class="s2">&quot;lincom&quot;</span><span class="p">)])</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">([(</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;r()&quot;</span><span class="p">),</span>     <span class="p">(</span><span class="s2">&quot;lincom&quot;</span><span class="p">,</span> <span class="s2">&quot;r()*&quot;</span><span class="p">)</span> <span class="p">])</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">([(</span><span class="s2">&quot;r()&quot;</span><span class="p">,</span> <span class="s2">&quot;local&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;r()*&quot;</span><span class="p">,</span> <span class="s2">&quot;local&quot;</span><span class="p">)])</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">([(</span><span class="s2">&quot;local&quot;</span><span class="p">,</span><span class="s2">&quot;embed&quot;</span><span class="p">)])</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> 
        <span class="n">nx</span><span class="o">.</span><span class="n">get_node_attributes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;pos&#39;</span><span class="p">),</span> 
        <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
        <span class="n">font_weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> 
        <span class="n">node_size</span> <span class="o">=</span> <span class="mi">3500</span><span class="p">,</span>
        <span class="n">node_color</span> <span class="o">=</span> <span class="s2">&quot;lightblue&quot;</span><span class="p">,</span>
        <span class="n">linewidths</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">collections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s2">&quot;#000000&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/4f7acfe785a5179adea8fa721905f9460c254410c8d4572cc20481eea03aa197.png" src="_images/4f7acfe785a5179adea8fa721905f9460c254410c8d4572cc20481eea03aa197.png" />
</div>
</div>
<p>I’ve not illustrated where <code class="docutils literal notranslate"><span class="pre">e()</span></code> and <code class="docutils literal notranslate"><span class="pre">c()</span></code> fit in this scheme. But once you appreciate that <code class="docutils literal notranslate"><span class="pre">r()</span></code> values in memory can be revealed using <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">list</span></code>, <code class="docutils literal notranslate"><span class="pre">e()</span></code> values using <code class="docutils literal notranslate"><span class="pre">ereturn</span> <span class="pre">list</span></code>, and <code class="docutils literal notranslate"><span class="pre">c()</span></code> values using <code class="docutils literal notranslate"><span class="pre">creturn</span> <span class="pre">list</span></code> then you will be set for life!!</p>
<p>The local macros you define will ultimately be embedded in programs you write or the text, tables, and figures of your final manuscripts.</p>
<p>We’ve seen how to embed a local macro in text <strong>after</strong> appropriately formatting the r() or e() content:</p>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="k">di</span> <span class="s">&quot;We have seen how to embed a </span><span class="nv">`local macro&#39;</span><span class="s"> in text, but such macros may be embeded in tables and graphs as well!&quot;</span>
</pre></div>
</div>
<p>Remember:</p>
<ol class="arabic simple">
<li><p>names: r(), e(), c()</p></li>
<li><p>content: return, estimates, constants</p></li>
<li><p>these system-defined local macros may then be formatted to suit your needs in a user-defined local macro</p></li>
</ol>
<p>In context of the first three weeks here is where things stand:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pwd</span></code> —&gt; dofile structure, working directory, location of output</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">r(mean)</span></code> —&gt; macros, local system-defined, user-defined</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">by</span></code> —&gt; prelude to <code class="docutils literal notranslate"><span class="pre">program</span> <span class="pre">define</span></code></p></li>
</ol>
<p>For today’s session, <code class="docutils literal notranslate"><span class="pre">by</span></code>, you’ll use <a class="reference download internal" download="" href="_downloads/34a8255f06036b44354b3c36c5583d7e/transplants.dta"><span class="xref download myst">transplants.dta</span></a> to demonstrate a few useful commands that we will put to good use over the coming weeks. You should be able to do most of this session on your own and at your convenience since it merely exposes you to various commands but not in the context of any specfic task.</p>
<div class="highlight-Stata notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> transplants,<span class="k"> clear</span>
</pre></div>
</div>
<p>What if we want a variable of the total number of records in each ABO blood type?</p>
<div class="highlight-Stata notranslate"><div class="highlight"><pre><span></span><span class="k">bys</span> abo:<span class="k"> gen</span> cat_n = _N
</pre></div>
</div>
<p>So what did this code achieve?</p>
<div class="highlight-Stata notranslate"><div class="highlight"><pre><span></span><span class="k">tab</span> cat_n
</pre></div>
</div>
<p>Let’s add labels to the groups:</p>
<div class="highlight-Stata notranslate"><div class="highlight"><pre><span></span>#delimit ;
<span class="k">lab</span> define abo_lab
   <span class="m">1</span> <span class="s">&quot;A&quot;</span>
   <span class="m">2</span> <span class="s">&quot;B&quot;</span>
   <span class="m">3</span> <span class="s">&quot;AB&quot;</span>
   <span class="m">4</span> <span class="s">&quot;O&quot;</span>
;
#delimit cr

<span class="k">lab</span> values abo abo_lab
</pre></div>
</div>
<p>Now lets tabulate once again:</p>
<div class="highlight-Stata notranslate"><div class="highlight"><pre><span></span><span class="k">tab</span> abo
</pre></div>
</div>
<p>Nice!</p>
<p>Ok. Do you remember these commands?</p>
<div class="highlight-Stata notranslate"><div class="highlight"><pre><span></span><span class="k">di</span> <span class="nf">c</span>(N)

<span class="k">di</span> <span class="nf">c</span>(k)
</pre></div>
</div>
<p>Lets create a <code class="docutils literal notranslate"><span class="pre">disturbance</span></code> to our setup to learn a few additional commands and their value to us:</p>
<div class="highlight-Stata notranslate"><div class="highlight"><pre><span></span><span class="k">qui do</span> https:<span class="o">//</span>raw<span class="m">.</span>githubusercontent<span class="m">.</span>com<span class="o">/</span>jhustata<span class="o">/</span>book<span class="o">/</span>main<span class="o">/</span>sample<span class="o">-</span>keep<span class="m">.</span>ado
</pre></div>
</div>
<p>Is that a new command? Or are you already familiar with it? How about this:</p>
<div class="highlight-Stata notranslate"><div class="highlight"><pre><span></span>samplekeep
</pre></div>
</div>
<p>What just happened?</p>
<div class="highlight-Stata notranslate"><div class="highlight"><pre><span></span><span class="k">di</span> <span class="nf">c</span>(N)

<span class="k">di</span> <span class="nf">c</span>(k)
</pre></div>
</div>
<p>Let’s rerun earlier commands to restore our sanity!</p>
<div class="highlight-Stata notranslate"><div class="highlight"><pre><span></span><span class="k">tab</span> abo
</pre></div>
</div>
<p>Ok, then. It was a temporary disturbance and peace was <code class="docutils literal notranslate"><span class="pre">restored</span></code>!! We will talk more about the <code class="docutils literal notranslate"><span class="pre">preserve</span></code> and <code class="docutils literal notranslate"><span class="pre">restore</span></code> commands, often used together.</p>
<p>Back to the <code class="docutils literal notranslate"><span class="pre">by</span></code> command:</p>
<div class="highlight-Stata notranslate"><div class="highlight"><pre><span></span><span class="k">bys</span> abo:<span class="k"> egen</span> age_byabo =<span class="k"> mean</span>(age)
</pre></div>
</div>
<p>Any idea what this command just achieved?</p>
<div class="highlight-Stata notranslate"><div class="highlight"><pre><span></span><span class="k">codebook</span> age_byabo
</pre></div>
</div>
<p>What do you notice? Only four unique values! The <code class="docutils literal notranslate"><span class="pre">egen</span></code> command, like the <code class="docutils literal notranslate"><span class="pre">gen</span></code> command is used to define new variables in the dataset. However, the <code class="docutils literal notranslate"><span class="pre">gen</span></code> command applies values at the level of the individual. The <code class="docutils literal notranslate"><span class="pre">egen</span></code> command does so <code class="docutils literal notranslate"><span class="pre">by</span></code> group and yields summary statistics. To learn more type <code class="docutils literal notranslate"><span class="pre">h</span> <span class="pre">egen</span></code>.</p>
<div class="highlight-Stata notranslate"><div class="highlight"><pre><span></span><span class="k">qui regress</span> peak_pra prev_ki
<span class="k">local</span> coef_of_det:<span class="k"> di</span> <span class="nx">%3.2f</span><span class="k"> e</span>(r2_a)<span class="o">*</span><span class="m">100</span>

<span class="k">di</span> <span class="s">&quot;History of kidney transplant explains </span><span class="nv">`coef_of_det&#39;</span><span class="s">% of the variance in peak_pra.&quot;</span>
</pre></div>
</div>
<p>From whence does <code class="docutils literal notranslate"><span class="pre">e(r2_a)</span></code> come? Where does it fit into our schema? (Hint: <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">list</span></code>, <code class="docutils literal notranslate"><span class="pre">ereturn</span> <span class="pre">list</span></code>, <code class="docutils literal notranslate"><span class="pre">creturn</span> <span class="pre">list</span></code>)</p>
<div class="highlight-Stata notranslate"><div class="highlight"><pre><span></span><span class="c1">//lets revisit this </span>
<span class="k">regress</span> age i<span class="m">.</span>abo
<span class="k">lincom</span> _b[<span class="m">3.</span>abo]
</pre></div>
</div>
<p>What blood group has value 3?</p>
<div class="highlight-Stata notranslate"><div class="highlight"><pre><span></span><span class="k">return list</span>
<span class="k">di</span> <span class="nx">%3.2f</span> <span class="nf">r</span>(p)
<span class="k">di</span> <span class="nx">%3.2f</span> <span class="nf">r</span>(estimate)
</pre></div>
</div>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">//does this output look familiar?</span>
<span class="k"> lincom</span> _cons <span class="o">+</span> _b[<span class="m">3.</span>abo]
<span class="k"> return list</span> 

<span class="c1">//regression is a fancy way of estimating means for specified groups</span>
<span class="k"> codebook</span> age_byabo
</pre></div>
</div>
<p>Remember to use <code class="docutils literal notranslate"><span class="pre">lincom</span></code> appropriately, depending on what you wish to describe!</p>
<p>After a regression we may type <code class="docutils literal notranslate"><span class="pre">ereturn</span> <span class="pre">list</span></code> for all sorts of estimated values:</p>
<div class="highlight-Stata notranslate"><div class="highlight"><pre><span></span><span class="k">matrix</span> define b =<span class="k"> e</span>(b)
<span class="k">matrix list</span> b
<span class="k">di</span> b[<span class="m">1</span>,<span class="m">3</span>]
</pre></div>
</div>
<p>You should explore the following commands, one-by-one, on your own:</p>
<div class="highlight-Stata notranslate"><div class="highlight"><pre><span></span><span class="k">tab</span> rec_education,<span class="k"> sum</span>(age)
<span class="k">regress</span> wait_yrs age, level(<span class="m">90</span>)
<span class="k">count if</span> age <span class="o">&gt;</span> <span class="m">50</span>
<span class="k">count if</span> <span class="nf">inrange</span>(age,<span class="m">50</span>,<span class="m">90</span>)
<span class="k">list</span> age dx rec_education<span class="k"> in</span> <span class="m">1</span><span class="o">/</span><span class="m">5</span>

<span class="c1">//di c(N) &quot; &amp; &quot; c(k)</span>
<span class="k">use</span> age dx using transplants,<span class="k"> clear</span>
<span class="k">use</span> transplants<span class="k"> in</span> <span class="m">1</span><span class="o">/</span><span class="m">50</span>,<span class="k"> clear</span>
<span class="k">use</span> transplants<span class="k"> in</span> <span class="m">44</span>
<span class="k">use</span> transplants<span class="k"> if</span> rec_work<span class="o">==</span><span class="m">1</span>
<span class="k">use</span> a<span class="o">*</span> p<span class="o">*</span> using transplants<span class="k"> in</span> <span class="m">1</span><span class="o">/</span><span class="m">100</span>
</pre></div>
</div>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">//describe</span>
<span class="k">describe</span>, simple
<span class="k">describe</span>, short
<span class="k">describe</span> a<span class="o">*</span>
<span class="k">describe</span> using transplants<span class="m">.</span>dta 
<span class="k">describe</span> r<span class="o">*</span>, fullnames

<span class="c1">//codebook</span>
<span class="k">codebook</span>
<span class="k">codebook</span> rec_education rec_work abo
<span class="k">codebook</span> a<span class="o">*</span><span class="k"> e</span><span class="o">*</span>, compact
<span class="k">codebook</span>, problems

<span class="c1">//list </span>
<span class="k">list</span> 
<span class="k">list</span> prev_ki wait_yrs<span class="k"> if</span> race<span class="o">==</span><span class="m">9</span>
<span class="k">list</span> <span class="o">*</span>date<span class="k"> in</span> <span class="m">1</span><span class="o">/</span><span class="m">10</span>
<span class="k">list</span> dx<span class="k"> in</span> <span class="m">1</span><span class="o">/</span><span class="m">10</span>, clean noobs
<span class="k">list</span> age, fast

<span class="c1">//count</span>
<span class="k">count</span>
<span class="k">count if</span> rec_work<span class="o">==</span><span class="m">1</span>
<span class="k">count if</span> rec_work<span class="o">!=</span><span class="m">1</span>
<span class="k">count if</span> bmi<span class="o">&lt;</span><span class="m">20</span> | bmi <span class="o">&gt;</span> <span class="m">35</span>
<span class="k">count if</span> bmi<span class="o">&gt;</span><span class="m">25</span> <span class="o">&amp;</span> bmi <span class="o">&lt;</span><span class="m">30</span>
<span class="k">count if</span> <span class="o">!</span>(age<span class="o">&gt;</span><span class="m">18</span>)
<span class="k">count if</span> <span class="nf">inrange</span>(wait_yrs,<span class="m">4</span>,<span class="m">6</span>)
<span class="k">count if</span> <span class="o">!</span><span class="nf">inlist</span>(gender,<span class="m">0</span>,<span class="m">1</span>)

<span class="c1">//tabulate</span>
<span class="k">tab</span> abo
<span class="k">tab</span> abo rec_hcv
<span class="k">tab</span> gender,<span class="k"> sum</span>(age)
<span class="k">tab</span> dx gender<span class="k"> if</span> age<span class="o">&lt;</span><span class="m">40</span>
<span class="k">tab</span> dx gender,row
<span class="k">tab</span> dx gender,col nofreq

<span class="k">tab</span> dx gender, col nofreq chi2
<span class="k">return list</span> 

<span class="c1">//summarize</span>
<span class="k">sum</span>
<span class="k">return list</span> <span class="c1">//not very useful; see schema above</span>

<span class="k">sum</span> age wait_yrs
<span class="k">return list</span> <span class="c1">//much more useful!</span>

<span class="k">sum</span> age wait_yrs, detail

<span class="c1">//missingness</span>
<span class="k">count if</span> bmi <span class="o">&gt;</span> <span class="m">30</span>
<span class="k">count if</span> bmi <span class="o">&gt;</span> <span class="m">1000</span> <span class="c1">//wha? </span>
<span class="k">sum</span> bmi <span class="c1">//whats going on?</span>
<span class="k">assert</span> <span class="nf">c</span>(N) <span class="o">==</span> <span class="nf">r</span>(N) <span class="c1">//when do these diverge?</span>
<span class="k">tab</span> bmi<span class="k"> if</span> bmi <span class="o">&gt;</span> <span class="m">1000</span>
<span class="k">tab</span> bmi<span class="k"> if</span> bmi <span class="o">&gt;</span> <span class="m">1000</span>, missing

<span class="k">count if</span> bmi<span class="o">==</span>.
<span class="k">count if</span> bmi<span class="o">==</span>.a
<span class="k">count if</span> <span class="nf">missing</span>(bmi)
</pre></div>
</div>
<p>Let’s discuss <a class="reference external" href="https://stats.oarc.ucla.edu/stata/faq/how-can-i-recode-missing-values-into-different-categories/">missingness</a> as its relevance emerges.</p>
<div class="highlight-Stata notranslate"><div class="highlight"><pre><span></span><span class="c1">//manipulating data</span>
<span class="k">gen</span> age_lastyear=age<span class="m">-1</span>
<span class="k">gen</span> any_college=(rec_educ<span class="o">&gt;=</span><span class="m">3</span>)
<span class="k">g</span> youngman=(age<span class="o">&lt;</span><span class="m">40</span><span class="o">&gt;</span>)<span class="o">&amp;</span>(gender<span class="o">==</span><span class="m">0</span>)
</pre></div>
</div>
<p>Variable <strong>types</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">byte</span></code>: integer range -127 to 100</p>
<p><code class="docutils literal notranslate"><span class="pre">int</span></code>: integer range -32767 to 32740</p>
<p><code class="docutils literal notranslate"><span class="pre">long</span></code>: integer range <span class="math notranslate nohighlight">\(\pm\)</span> 2 billion</p>
<p><code class="docutils literal notranslate"><span class="pre">float</span></code>: decimal, range <span class="math notranslate nohighlight">\(\pm\)</span> <span class="math notranslate nohighlight">\(10^{38}\)</span></p>
<p><code class="docutils literal notranslate"><span class="pre">double</span></code>: decimal, range <span class="math notranslate nohighlight">\(\pm\)</span> <span class="math notranslate nohighlight">\(10^{307}\)</span></p>
<p><code class="docutils literal notranslate"><span class="pre">strings</span></code>: e.g. str5 = string of length 5</p>
<p>You’ll need to specify the variable types as you start to right flexible programs with the <code class="docutils literal notranslate"><span class="pre">program</span> <span class="pre">define</span></code> command and <code class="docutils literal notranslate"><span class="pre">syntax</span></code> command with options such as<code class="docutils literal notranslate"><span class="pre">,</span> <span class="pre">time(varname)</span> <span class="pre">event(varname)</span> <span class="pre">tmax(float)</span></code></p>
<p>If you wish to better understand these variables types, please explore those available to you in <code class="docutils literal notranslate"><span class="pre">transplants.dta</span></code>. Open the dataset and type <code class="docutils literal notranslate"><span class="pre">desc</span></code>.</p>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> transplants,<span class="k"> clear</span>
<span class="k">describe</span>
</pre></div>
</div>
<div class="highlight-Stata notranslate"><div class="highlight"><pre><span></span><span class="c1">//generate</span>
<span class="k">g</span> byte young=(age<span class="o">&lt;</span><span class="m">30</span><span class="o">&gt;</span>)
<span class="k">g</span> age_f=age<span class="k"> if</span> gender<span class="o">==</span><span class="m">1</span>
<span class="k">g</span> age_spline=(age<span class="o">&gt;</span><span class="m">40</span>)<span class="o">*</span>(age<span class="m">-40</span>)

<span class="c1">//_n and _N</span>
<span class="k">g</span> new_id=_n
<span class="k">gen</span> total_records=_N
<span class="k">g</span> percentile=<span class="m">100</span><span class="o">*</span>_n<span class="o">/</span>_N

<span class="c1">//drop/keep</span>
<span class="k">keep</span> age gender bmi fake_id ra<span class="o">*</span>
<span class="k">drop</span> end_date

<span class="c1">//remember: to load the original dataset again</span>
<span class="k">use</span> transplants,<span class="k"> clear</span>
<span class="k">keep in</span> <span class="m">1</span><span class="o">/</span><span class="m">100</span>
<span class="k">drop if</span> wait_yrs<span class="o">&lt;</span><span class="m">1</span>
<span class="k">keep if</span> prev_ki<span class="o">==</span><span class="m">1</span>
<span class="k">drop if</span> age<span class="o">&lt;</span><span class="m">18</span> <span class="o">&amp;</span> abo<span class="o">==</span><span class="m">2</span>

<span class="c1">//load data again</span>
<span class="k">use</span> transplants,<span class="k"> clear</span>
<span class="k">replace</span> prev=<span class="m">0</span>
<span class="k">replace</span> wait_yrs=<span class="m">5</span><span class="k"> if</span> wait_yrs<span class="o">&gt;</span><span class="m">5</span>
<span class="k">replace</span> gender=gender<span class="m">+1</span>
<span class="k">replace</span> bmi=.<span class="k"> if</span> <span class="o">!</span><span class="nf">inrange</span>(bmi,<span class="m">17</span>,<span class="m">50</span>)

<span class="c1">//rename</span>
<span class="k">rename</span> age age_at_transplant
<span class="k">rename</span> gender female

<span class="k">use</span> transplants,<span class="k"> clear</span>
<span class="k">rename</span> (age gender)(age_at_transplant female)

<span class="c1">//sort, gsort</span>
<span class="k">list in</span> <span class="m">1</span><span class="o">/</span><span class="m">10</span> 
<span class="k">sort</span> age
<span class="k">list in</span> <span class="m">1</span><span class="o">/</span><span class="m">10</span>
<span class="k">sort</span> age dx
<span class="k">list in</span> <span class="m">1</span><span class="o">/</span><span class="m">10</span>
<span class="k">gsort</span> <span class="o">-</span>age dx <span class="o">-</span>race 
<span class="k">list in</span> <span class="m">1</span><span class="o">/</span><span class="m">10</span>

<span class="c1">//recode</span>
<span class="k">recode</span> rec_education (<span class="m">3</span> <span class="m">4</span> <span class="m">5</span> =<span class="m">9</span>)
<span class="k">recode</span> dx (<span class="m">1</span>=<span class="m">1</span>)(<span class="m">2</span>=<span class="m">2</span>)(<span class="o">*</span>=<span class="m">9</span>)
<span class="k">recode</span> gender (<span class="m">0</span>=<span class="m">1</span>)(<span class="m">1</span>=<span class="m">0</span>),gen(male)

<span class="c1">//display</span>
<span class="k">sum</span> wait_yrs
<span class="k">di</span> <span class="s">&quot;variable&quot;</span> _col(<span class="m">20</span>) <span class="s">&quot;mean&quot;</span>
<span class="k">di</span> <span class="s">&quot;wait time&quot;</span> _col(<span class="m">20</span>) <span class="nf">r</span>(mean)

<span class="c1">//capture</span>
<span class="k">capture sum</span> nonexistent_variable
<span class="k">capture di</span> <span class="m">4+3</span>
<span class="k">capture di</span> <span class="m">4</span><span class="o">+</span>

<span class="c1">//assert </span>
<span class="k">assert</span> age<span class="o">&lt;</span><span class="m">100</span>
<span class="k">assert</span> end_date<span class="o">&gt;=</span>transplant_date
<span class="k">assert</span> <span class="nf">inlist</span>(gender,<span class="m">0</span>,<span class="m">1</span>)
<span class="k">assert</span> <span class="m">2</span><span class="o">&lt;</span><span class="m">1</span>
<span class="k">assert</span> <span class="m">0</span>
<span class="k">assert</span> <span class="nf">c</span>(edition_real)<span class="o">==</span><span class="s">&quot;BE&quot;</span>
<span class="k">assert</span> <span class="nf">c</span>(edition_real)<span class="o">==</span><span class="s">&quot;MP&quot;</span>

<span class="c1">//recode+label</span>
#delimit ;
<span class="k">recode</span> race 
    (<span class="m">1</span>=<span class="m">0</span> <span class="s">&quot;Cauc&quot;</span>)
    (<span class="m">2</span>=<span class="m">1</span> <span class="s">&quot;AA)</span>
    (<span class="m">4</span>=<span class="m">2</span> <span class="s">&quot;Hisp/Latino&quot;</span>)
    (<span class="m">5</span><span class="o">/</span><span class="m">9</span>=<span class="m">3</span> <span class="s">&quot;Other&quot;</span>),
<span class="k">        gen</span>(race_cat)
;
#delimit cr

<span class="c1">//preserve &amp; restore</span>
<span class="k">sum</span> age

<span class="c1">//indentation!</span>
<span class="k">preserve</span>
<span class="k">    drop if</span> age<span class="o">&lt;</span><span class="nf">r</span>(mean)
<span class="k">    sum</span> age
<span class="k">restore</span> 

<span class="k">sum</span> age
</pre></div>
</div>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">//comments</span>

<span class="k">sum</span> age <span class="c1">//this displays mean, range, etc.</span>

<span class="cm">/*</span>
<span class="cm">Here&#39;s a long comment. It takes up several</span>
<span class="cm">lines, so I use the slash/asterisk.</span>
<span class="cm">*/</span>

<span class="cm">* Asterisk as first characater=comment</span>

<span class="k">tab</span> race <span class="o">*</span> However, this doesn&#39;t work

<span class="k">if</span> <span class="m">0</span> { <span class="c1">//background: ph.340.600</span>

    <span class="m">1</span>. we prefer <span class="nv">`if 0 {&#39;</span><span class="k"> for</span> comments
    <span class="m">2</span>. and brief <span class="nv">`//&#39;</span> annotations per <span class="nv">`if int {&#39;</span> code<span class="o">-</span>block
    <span class="m">3</span>.<span class="k"> do</span> not<span class="k"> use</span> comments to explain a command
    <span class="m">4</span>. that is what <span class="nv">`help&#39;</span> is<span class="k"> for</span>
    <span class="m">5</span>. our approach is avant<span class="o">-</span>garde

}
</pre></div>
</div>
<p>Notebooks such as Jupyter notebook enable analysts to merge richer documentation together with analysis code, that isn’t quite possible in Stata. This class book is such an example of notebook that I have “hacked” from its Python roots for our Stata class.</p>
<p>For the curious few who looked closer at the schema outlined at the beginning of this class, you might have found some hidden but strange-looking code that produced the figure. That is python code.</p>
<p>I’m unable to input Stata code and display output in this Jupyter book. But the <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">integer</span> <span class="pre">{</span></code> blocks that I’ve recommended for this class are actually inspired by Jupyter notebooks, where <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">0</span> <span class="pre">{</span></code> represent documentation blocks and <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">int</span> <span class="pre">{</span></code> represent code-blocks.</p>
<p>To me, <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">0</span> <span class="pre">{</span></code> is infinitely more aesthetic than blocked-off green chuncks of annotated text, an approach familiar to most Stata users.</p>
<p>Jupyter books such as this are a major step forward in efforts toward reproducible research.</p>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">//line continuation</span>

<span class="c1">//Use `///` to make a Stata command span several lines in a .do file</span>

<span class="k">recode</span> race <span class="cs">///</span>
    (<span class="m">1</span>=<span class="m">1</span>) <span class="cs">///</span>
    (<span class="m">2</span>=<span class="m">2</span>) <span class="cs">///</span>
    (<span class="m">4</span> <span class="m">5</span> <span class="m">6</span> <span class="m">7</span> <span class="m">9</span> = <span class="m">9</span>)

<span class="c1">//That is the main-stream approach to line continuation. Ours?</span>

#delimit ;
<span class="k">recode</span> race
    (<span class="m">1</span>=<span class="m">1</span>)
    (<span class="m">2</span>=<span class="m">2</span>)
    (<span class="m">4</span> <span class="m">5</span> <span class="m">6</span> <span class="m">7</span> <span class="m">9</span>)
;
#delimit cr
</pre></div>
</div>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">//labels</span>
<span class="k">describe</span> dx
<span class="k">label var</span> dx <span class="s">&quot;kidney disease diagnosis&quot;</span>

<span class="k">tab</span> gender <span class="c1">//is 1 male or female?</span>
#delimit ;
<span class="k">label</span> define g_label 
    <span class="m">0</span> <span class="s">&quot;0=Male&quot;</span>
    <span class="m">1</span> <span class="s">&quot;1-Female&quot;</span>
;
#delimit cr
<span class="k">label</span> values gender g_label
<span class="k">tab</span> gender <span class="c1">//much better</span>
<span class="k">tab</span> gender, nolabel <span class="c1">//don&#39;t show label</span>

<span class="c1">//or?</span>
<span class="k">g</span> female=gender<span class="o">==</span><span class="m">1</span> <span class="c1">//intuitive meaning of 1 &amp; 0</span>
</pre></div>
</div>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">//r-class examples</span>
<span class="k">count if</span> age <span class="o">&lt;</span> <span class="m">45</span>
<span class="k">di</span> <span class="nf">r</span>(N) <span class="s">&quot; young patients&quot;</span>

<span class="k">tab</span> race abo, chi2
<span class="k">di</span> <span class="s">&quot;p-value: &quot;</span> <span class="nf">r</span>(p)
</pre></div>
</div>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="k">sum</span> age
<span class="k">assert</span> <span class="nf">inrange</span>(<span class="nf">r</span>(mean),<span class="m">45</span>,<span class="m">55</span>)

<span class="k">tab</span> race abo, chi2
asset <span class="nf">r</span>(p) <span class="o">&lt;</span> <span class="m">0.05</span>
</pre></div>
</div>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">//display formats</span>
<span class="k">sum</span> bmi <span class="c1">//command</span>
<span class="k">local</span> bmi_mean:<span class="k"> di</span> <span class="nx">%4.1f</span> <span class="nf">r</span>(mean) <span class="c1">//r() -&gt; local</span>
<span class="k">di</span> <span class="s">&quot;Mean BMI: </span><span class="nv">`bmi_mean&#39;</span><span class="s"> &quot;</span> <span class="c1">//embed in text or other final output</span>
</pre></div>
</div>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">//_b coefficient matrix</span>

<span class="k">regress</span> bmi gender age

#delimit ;
<span class="k">di</span> <span class="s">&quot;estimated BMI: &quot;</span> <span class="nx">%3.2f</span> _b[_cons] <span class="s">&quot; + &quot;</span> 
                     <span class="nx">%3.2f</span> _b[age] <span class="s">&quot;*age (+ &quot;</span> 
                           _b[gender] <span class="s">&quot; if male)&quot;</span>
;
#delimit cr
</pre></div>
</div>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">//local macros</span>
<span class="k">qui sum</span> age<span class="k"> if</span> gender<span class="o">==</span><span class="m">0</span>
<span class="k">local</span> age_m: <span class="nx">%3.1f</span> <span class="nf">r</span>(mean)

<span class="k">qui sum</span> age<span class="k"> if</span> gender<span class="o">==</span><span class="m">1</span>
<span class="k">local</span> age_f: <span class="nx">%3.1f</span> <span class="nf">r</span>(mean)

<span class="k">di</span> <span class="s">&quot;Mean age: </span><span class="nv">`age_m&#39;</span><span class="s"> (males) </span><span class="nv">`age_f&#39;</span><span class="s"> (females) &quot;</span> 
</pre></div>
</div>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">//more local macros</span>
<span class="k">local</span> confounders age gender peak_pra
<span class="k">regress</span> bmi wait_yrs <span class="nv">`confoundres&#39;</span>
</pre></div>
</div>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">//program define</span>
<span class="k">capture program drop</span> table1
<span class="k">program</span> define table1
    #delimit ;
<span class="k">    disp</span> <span class="s">&quot;Variable&quot;</span> _col(<span class="m">20</span>) <span class="s">&quot;mean (SD)&quot;</span> 
                    _col(<span class="m">40</span>) <span class="s">&quot;range&quot;</span>
                    ;
    #delimit cr

<span class="k">    quietly sum</span> age
    #delimit ;
<span class="k">    disp</span> <span class="s">&quot;age&quot;</span> _col(<span class="m">20</span>) <span class="nx">%3.2f</span> <span class="nf">r</span>(mean) 
              <span class="s">&quot; (&quot;</span> <span class="nx">%3.2f</span> <span class="nf">r</span>(sd) <span class="s">&quot;)&quot;</span>
               _col(<span class="m">40</span>)  <span class="nx">%3.2f</span> <span class="nf">r</span>(min) <span class="s">&quot;-&quot;</span> <span class="nx">%3.2f</span> <span class="nf">r</span>(max)
               ;
    #delimit cr
     <span class="c1">//add more variables!</span>
<span class="k">    end</span>

    table1
</pre></div>
</div>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">//tagging</span>
<span class="k">list</span> abo gender spread
<span class="k">egen</span> = tag
<span class="k">egen</span> grouptag = tag(abo gender)
<span class="k">list</span> abo gender spread<span class="k"> if</span> grouptag
</pre></div>
</div>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> transplants,<span class="k"> clear</span>
<span class="k">egen</span> ethtag = tag(ethcat)
<span class="k">bys</span> ethcat:<span class="k"> egen</span> mean_bmi=mean(bmi)<span class="k"> bys</span> ethcat:<span class="k"> egen</span> mean_age=mean(age)
</pre></div>
</div>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="k">twoway scatter m</span><span class="o">~</span>_bmi<span class="k"> m</span><span class="o">~</span>_age<span class="k"> if</span> ethtag
</pre></div>
</div>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">//conditionals</span>
<span class="k">count if</span> abo<span class="o">==</span><span class="m">1</span>

<span class="k">if</span> _N <span class="o">&gt;</span> <span class="m">100</span> {
<span class="k">   </span>
<span class="k">    di</span> <span class="s">&quot;Thats a big dataset</span>

}

<span class="k">if</span> _N <span class="o">&gt;</span> <span class="m">10000</span> {

<span class="k">    di</span> <span class="s">&quot;That&#39;s a huge dataset&quot;</span>

}
</pre></div>
</div>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">//if and else</span>
<span class="k">if</span> _N <span class="o">&gt;</span> <span class="m">10000</span> {

<span class="k">    di</span> <span class="s">&quot;That&#39;s a huge dataset&quot;</span>

}

<span class="k">else</span> {

<span class="k">    di</span> <span class="s">&quot;Bah! Not so big.&quot;</span>

}
</pre></div>
</div>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">//some `if` examples</span>
<span class="k">quietly tab</span> dx gender, chi2

<span class="k">if</span> <span class="nf">r</span>(p) <span class="o">&lt;</span> <span class="m">0.01</span> {

<span class="k">    di</span> <span class="s">&quot;p&lt;0.01</span>

}

<span class="k">else</span> {

<span class="k">    di</span> <span class="nx">%3.2f</span> <span class="nf">r</span>(p)
}
</pre></div>
</div>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="k">count if</span> age<span class="o">&lt;</span><span class="m">18</span>
<span class="k">if</span> <span class="nf">r</span>(N) <span class="o">&gt;=</span><span class="m">200</span> {

<span class="k">    tab</span> gender prev_ki, chi2

}

<span class="k">else</span> {

<span class="k">    tab</span> gender prev_ki, exact
    
}
</pre></div>
</div>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="k">count if</span> <span class="o">!</span><span class="nf">inlist</span>(rec_hcv_antibody,<span class="m">0</span>,<span class="m">1</span>,.)

<span class="k">if</span> <span class="nf">r</span>(N) <span class="o">==</span><span class="m">0</span> {

<span class="k">    logistic</span> rec_hcv_antibody age

}

<span class="k">else</span> {

<span class="k">    di</span> <span class="s">&quot;Non-binary outcome.&quot;</span>
<span class="k">    di</span> <span class="s">&quot;Can&#39;t do logistic regression&quot;</span>
}
</pre></div>
</div>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">//loops</span>

<span class="k">forvalues</span> i = <span class="m">1</span><span class="o">/</span><span class="m">5</span> {

<span class="k">    di</span> <span class="nv">`i&#39;</span> <span class="c1">//a local macro, given the notation!!</span>

}
</pre></div>
</div>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="k">forvalues</span> b = <span class="m">35</span><span class="o">/</span><span class="m">45</span> {
<span class="k">    </span>
<span class="k">    quietly count if</span> age<span class="o">&gt;=</span><span class="nv">`b&#39;</span> <span class="o">&amp;</span> age<span class="o">&lt;</span><span class="nv">`b&#39;</span><span class="o">+</span><span class="m">1</span> 
<span class="k">    disp</span> <span class="s">&quot;Age of </span><span class="nv">`b&#39;</span><span class="s">: &quot;</span> <span class="nf">r</span>(N) <span class="s">&quot; patients&quot;</span>
    
}
</pre></div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Abimereki Muzaale
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>